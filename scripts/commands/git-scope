#!/usr/bin/env bash
set -euo pipefail

die() {
  echo "git-scope: $*" >&2
  exit 1
}

usage() {
  cat >&2 <<'EOF'
Usage:
  git-scope commit <rev> [--no-color]

Notes:
  - Minimal, repo-local implementation for codex-kit.
  - Intended to print a readable commit summary for reviews/logs.
EOF
}

if [[ "${1-}" == "-h" || "${1-}" == "--help" ]]; then
  usage
  exit 0
fi

cmd="${1-}"
rev="${2-}"

shift 2 || true

if [[ "$cmd" != "commit" || -z "$rev" ]]; then
  die "unsupported command (expected: git-scope commit <rev>)"
fi

no_color="0"
while [[ $# -gt 0 ]]; do
  case "${1-}" in
    --no-color)
      no_color="1"
      shift
      ;;
    -h|--help)
      usage
      exit 0
      ;;
    *)
      die "unknown argument: ${1-}"
      ;;
  esac
done

command -v git >/dev/null 2>&1 || die "missing required command: git"
git rev-parse --is-inside-work-tree >/dev/null 2>&1 || die "must run inside a git work tree"

export GIT_PAGER=cat
export PAGER=cat

no_color_flag=()
if [[ "$no_color" == "1" ]]; then
  no_color_flag+=(--no-color)
fi

git --no-pager show "${no_color_flag[@]}" --no-patch --stat "$rev"
